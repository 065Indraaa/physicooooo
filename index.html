<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Benchmark Ed25519 Key Scan (WASM + Worker)</title>
  <style>
    body { font-family: monospace; padding: 10px; }
    #log { white-space: pre; border: 1px solid #ccc; padding: 10px; max-height: 50vh; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>Ed25519 Key Scanner (Benchmark)</h2>

  <label>Target Base58 PublicKey:
    <input id="target" size="60" value="11111111111111111111111111111111">
  </label><br>

  <label>Workers:
    <input id="workers" type="number" value="4" min="1" max="16">
  </label><br>

  <button id="startBtn">Start</button>
  <button id="stopBtn" disabled>Stop</button>

  <div id="status"></div>
  <div id="log"></div>

  <script>
    let workers = [];
    let running = false;
    let totalChecked = 0;
    let startTime = 0;

    function log(msg) {
      const el = document.getElementById("log");
      el.textContent += msg + "\n";
      el.scrollTop = el.scrollHeight;
    }

    document.getElementById("startBtn").onclick = async () => {
      const target = document.getElementById("target").value.trim();
      const nWorkers = parseInt(document.getElementById("workers").value, 10);

      if (!target) return alert("Masukkan target Base58");

      document.getElementById("log").textContent = "";
      document.getElementById("status").textContent = "Starting...";
      document.getElementById("startBtn").disabled = true;
      document.getElementById("stopBtn").disabled = false;

      running = true;
      totalChecked = 0;
      startTime = performance.now();

      for (let i = 0; i < nWorkers; i++) {
        const w = new Worker("worker.js");
        w.onmessage = (e) => {
          const msg = e.data;
          if (msg.type === "progress") {
            totalChecked += msg.count;
          } else if (msg.type === "found") {
            log("FOUND: " + msg.seedHex + " â†’ " + msg.pubkeyBase58);
            stopAll();
          }
        };
        workers.push(w);
        w.postMessage({ cmd: "start", targetBase58: target, workerId: i, step: nWorkers });
      }

      // status updater
      function updateStatus() {
        if (!running) return;
        const elapsed = (performance.now() - startTime) / 1000;
        const rate = (totalChecked / elapsed).toFixed(0);
        document.getElementById("status").textContent =
          `Scanned: ${totalChecked} | Rate: ${rate}/sec | Time: ${elapsed.toFixed(1)}s`;
        requestAnimationFrame(updateStatus);
      }
      updateStatus();
    };

    document.getElementById("stopBtn").onclick = stopAll;

    function stopAll() {
      running = false;
      for (const w of workers) w.terminate();
      workers = [];
      document.getElementById("startBtn").disabled = false;
      document.getElementById("stopBtn").disabled = true;
      log("Stopped.");
    }
  </script>
</body>
</html>
